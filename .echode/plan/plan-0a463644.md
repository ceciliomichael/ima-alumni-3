# Donation Reports Filtering & Print Logic

## Overview
We will implement granular filtering for donation reports, specifically allowing users to filter by "Donor Name" and conditionally hiding the "Yearly Breakdown" section when it is redundant (e.g., for short date ranges or single-year reports). This ensures the generated reports and printouts are concise and relevant to the user's specific query.

## Architecture
- **Service Layer (`donationService.ts`)**: Update `generateDonationReport` to accept an optional `donorName` parameter and apply case-insensitive filtering.
- **UI Layer (`DonationReports.tsx`)**: Add a text input for donor name, manage its state, and update the report generation call. Implement conditional rendering for the "Yearly Breakdown" section based on the number of years in the report.
- **Utility Layer (`exportUtils.ts`)**: Update the PDF generation template to mirror the UI's logic, hiding the "Yearly Breakdown" table if the report covers only a single year.

## Step-by-Step Implementation

### 1. Update Donation Service
**File:** `src/services/firebase/donationService.ts`
- Update `generateDonationReport` function signature:
  ```typescript
  export const generateDonationReport = async (
    startDate?: string,
    endDate?: string,
    category?: string,
    donorName?: string // New parameter
  ): Promise<DonationReport>
  ```
- Add filtering logic inside the function:
  ```typescript
  if (donorName) {
    const term = donorName.toLowerCase();
    donations = donations.filter(d => 
      (d.donorName || '').toLowerCase().includes(term)
    );
  }
  ```

### 2. Update Donation Reports UI
**File:** `src/pages/Admin/components/DonationReports/DonationReports.tsx`
- Add state variable: `const [donorFilter, setDonorFilter] = useState('');`
- Add UI Input Field in the filters section (before or after Category):
  - Label: "Donor Name"
  - Input: Text field linked to `donorFilter`
- Update `handleGenerateReport` to pass `donorFilter` to `generateDonationReport`.
- Update "Yearly Breakdown" render condition:
  - Change condition from `Object.keys(report.byYear).length > 0` to `Object.keys(report.byYear).length > 1`.
  - This ensures it only shows when comparing multiple years.

### 3. Update PDF Export Utility
**File:** `src/utils/exportUtils.ts`
- In `exportReportToPDF`, wrap the "Yearly Breakdown" HTML section in a conditional block:
  ```typescript
  ${Object.keys(report.byYear).length > 1 ? `
    <h2>Yearly Breakdown</h2>
    <table>
      ... table content ...
    </table>
  ` : ''}
  ```
- This ensures the printout matches the user's preference for concise reports when a breakdown isn't needed.

## Edge Cases & Error Handling
- **Empty Donor Search:** If input is empty, ignore the filter (show all).
- **Case Sensitivity:** Search will be case-insensitive.
- **Null/Undefined Donor Names:** Handle gracefully with fallback empty strings during filter.
- **Single Year Data:** Logic automatically hides the breakdown if data falls within one calendar year.
- **Cross-Year Data:** If range is Dec 31, 2024 to Jan 1, 2025, breakdown will appear (2 years), which is correct behavior.